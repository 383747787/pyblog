<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Pyblog : Pyblog 是一个简单易用的在线 Markdown 博客系统，它使用 Python 的 flask 架构，理论上支持所有 flask-sqlalchemy 所能支持的数据库。博客的内容全部是 Markdown 格式，你只需要将写好的 Markdown文件的内容提交即可。同时支持多说评论，百度统计，代码高亮等常用功能。">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Pyblog</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/eastossifrage/pyblog">View on GitHub</a>

          <h1 id="project_title">Pyblog</h1>
          <h2 id="project_tagline">Pyblog 是一个简单易用的在线 Markdown 博客系统，它使用 Python 的 flask 架构，理论上支持所有 flask-sqlalchemy 所能支持的数据库。博客的内容全部是 Markdown 格式，你只需要将写好的 Markdown文件的内容提交即可。同时支持多说评论，百度统计，代码高亮等常用功能。</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/eastossifrage/pyblog/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/eastossifrage/pyblog/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="pyblog--喜欢markdown爱上pyblog" class="anchor" href="#pyblog--%E5%96%9C%E6%AC%A2markdown%E7%88%B1%E4%B8%8Apyblog" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Pyblog —— 喜欢Markdown，爱上Pyblog!</h1>

<blockquote>
<p>Pyblog 是一个简单易用的在线 Markdown 博客系统，它使用 Python 的 flask 架构，理论上支持所有 flask-sqlalchemy 所能支持的数据库。博客的内容全部是 Markdown 格式，你只需要将写好的 Markdown文件的内容提交即可。同时支持多说评论，百度统计，代码高亮等常用功能。</p>
</blockquote>

<h2>
<a id="用法" class="anchor" href="#%E7%94%A8%E6%B3%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>用法</h2>

<h3>
<a id="应用环境介绍" class="anchor" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>应用环境介绍</h3>

<ul>
<li>支持 Linux 系统，本程序默认为 Ubuntu 14.04 - 16.04 系统。</li>
<li>默认的python， 2.7.6 - 2.7.11+。</li>
<li>Ubuntu 系统默认安装的nginx。</li>
<li>默认使用系统自带的 sqlite 数据库。</li>
</ul>

<h3>
<a id="文件组织架构" class="anchor" href="#%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>文件组织架构</h3>

<div class="highlight highlight-source-shell"><pre>gyblog/
    app/
    blog/
    config.py
    manage.py</pre></div>

<h3>
<a id="安装-flask-的虚拟环境" class="anchor" href="#%E5%AE%89%E8%A3%85-flask-%E7%9A%84%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>安装 flask 的虚拟环境</h3>

<div class="highlight highlight-source-shell"><pre>$ sudo apt-get install python-virtualenv
$ <span class="pl-c1">cd</span> gyblog <span class="pl-c">#可以自定义目录的命名</span>
$ virtualenv flask
$ <span class="pl-c1">source</span> flask/bin/activate
(flask)$
(flask)$ pip install -r requirements.txt</pre></div>

<h3>
<a id="安装-uwsgi" class="anchor" href="#%E5%AE%89%E8%A3%85-uwsgi" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>安装 uWSGI</h3>

<div class="highlight highlight-source-shell"><pre>sudo apt-get update <span class="pl-k">&amp;&amp;</span> sudo apt-get upgrade
sudo apt-get install build-essential python python-dev
sudo pip install uwsgi</pre></div>

<h3>
<a id="配置-nginx" class="anchor" href="#%E9%85%8D%E7%BD%AE-nginx" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>配置 nginx</h3>

<div class="highlight highlight-source-shell"><pre>sudo vi /etc/nginx/sites-available/default</pre></div>

<h4>
<a id="设置nginx用户组" class="anchor" href="#%E8%AE%BE%E7%BD%AEnginx%E7%94%A8%E6%88%B7%E7%BB%84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>设置nginx用户组</h4>

<p>修改nginx配置<code>/etc/nginx/nginx.conf</code>的启动用户</p>

<div class="highlight highlight-source-shell"><pre>第1行 user os373  <span class="pl-c">#最好是系统的当前用户</span></pre></div>

<h4>
<a id="新增一下内容" class="anchor" href="#%E6%96%B0%E5%A2%9E%E4%B8%80%E4%B8%8B%E5%86%85%E5%AE%B9" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>新增一下内容：</h4>

<div class="highlight highlight-source-shell"><pre>
server {
        listen 80<span class="pl-k">;</span>
        server_name os373.cn<span class="pl-k">;</span> <span class="pl-c"># 自己的网站域名</span>
        charset utf-8<span class="pl-k">;</span>
        client_max_body_size 75M<span class="pl-k">;</span>

        location / {
                try_files <span class="pl-smi">$uri</span> @pyblog<span class="pl-k">;</span>
        }
        locahion @pyblog {
                include uwsgi_params<span class="pl-k">;</span>
                uwsgi_pass unix:/var/www/pyblog/pyblog_uwsgi.sock<span class="pl-k">;</span>
        }
}</pre></div>

<h3>
<a id="配置-uwsgi" class="anchor" href="#%E9%85%8D%E7%BD%AE-uwsgi" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>配置 uWSGI</h3>

<h3>
<a id="设置进程用户权限" class="anchor" href="#%E8%AE%BE%E7%BD%AE%E8%BF%9B%E7%A8%8B%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>设置进程用户权限</h3>

<p>同时，最后一行说明用来运行守护进程的用户是os373。为简单起见，将这个用户设置成应用和日志文件夹的所有者。</p>

<h4>
<a id="设置用户组" class="anchor" href="#%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%BB%84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>设置用户组</h4>

<div class="highlight highlight-source-shell"><pre>sudo mkdir /var/log/uwsgi
sudo chown -R os373:os373 /var/www/pyblog/
sudo chown -R os373:os373 /var/log/uwsgi/</pre></div>

<h4>
<a id="uwsgi配置文件" class="anchor" href="#uwsgi%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>uWSGI配置文件</h4>

<p>创建一个新的uWSGI配置文件/var/www/pyblog/pyblog_uwsgi.ini</p>

<div class="highlight highlight-source-shell"><pre>[uwsgi]
base = /var/www/pyblog
app = manage
module = %(app)

home = %(base)/flask
pythonpath = %(base)
socket = /var/www/pyblog/%n.sock
master = <span class="pl-c1">true</span>
processes = 8
workers = 2
chmod-socket = 644
callable = app
logto = /var/log/uwsgi/%n.log
</pre></div>

<p>执行uWSGI，用新创建的配置文件作为参数：</p>

<div class="highlight highlight-source-shell"><pre>uwsgi --ini /var/www/pybolg/pyblog_uwsgi.ini</pre></div>

<p>我们的工作现在基本完成了，唯一剩下的事情是配置uWSGI在后台运行，这是uWSGI Emperor的职责。</p>

<h4>
<a id="uwsgi-emperor" class="anchor" href="#uwsgi-emperor" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>uWSGI Emperor</h4>

<p>创建一个初始配置来运行emperor - <code>sudo vi /etc/init/uwsgi.conf</code>：</p>

<div class="highlight highlight-source-shell"><pre>description <span class="pl-s"><span class="pl-pds">"</span>uWSGI<span class="pl-pds">"</span></span>
start on runlevel [2345]
stop on runlevel [06]
respawn

env UWSGI=/usr/local/bin/uwsgi
env LOGTO=/var/log/uwsgi/emperor.log

<span class="pl-c1">exec</span> <span class="pl-smi">$UWSGI</span> --master --emperor /etc/uwsgi/vassals --die-on-term --uid os373 --gid os373 --logto <span class="pl-smi">$LOGTO</span></pre></div>

<p>最后一行运行uWSGI守护进程并让它到/etc/uwsgi/vassals文件夹查找配置文件。创建这个文件夹，在其中建立一个到链到我们刚创建配置文件的符号链接。</p>

<div class="highlight highlight-source-shell"><pre>sudo mkdir /etc/uwsgi <span class="pl-k">&amp;&amp;</span> sudo mkdir /etc/uwsgi/vassals
sudo ln -s /var/www/pyblog/pyblog_uwsgi.ini /etc/uwsgi/vassals</pre></div>

<p>现在，flask应用就应该配置完成了。</p>

<h3>
<a id="配置flask应用数据库" class="anchor" href="#%E9%85%8D%E7%BD%AEflask%E5%BA%94%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>配置flask应用数据库</h3>

<div class="highlight highlight-source-shell"><pre>(flask)$ python manage.py db init
(flask)$ python manage.py db migrate -m <span class="pl-s"><span class="pl-pds">"</span>initial migration<span class="pl-pds">"</span></span>
(flask)$ python manage.py db upgrade</pre></div>

<h3>
<a id="重新启动服务" class="anchor" href="#%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>重新启动服务</h3>

<div class="highlight highlight-source-shell"><pre>sudo service nginx restart
sudo service uwsgi restart</pre></div>

<p>你可以查看<code>/var/log/uwsgi/</code>文件夹下的access.log和error.log内容，并根据提示来判断程序是否正常运行。</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Pyblog maintained by <a href="https://github.com/eastossifrage">eastossifrage</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
