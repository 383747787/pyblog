{% extends 'common/base.html' %}
{% block content %}
<div class="write-article">
    <div class="row">
        <form method="post" role="form">
            {{ writeArticleForm.hidden_tag() }}
            <div class="col-xs-12 col-sm-10">
                <div class="input-group">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-file"></i></span>
                    {{ writeArticleForm.title(class="form-control", placeholder="文章标题", required="", autofocus="")}}
                </div>
            </div>
            <div class="col-xs-12 col-sm-2" style="padding-top: 10px; padding-bottom: 10px">
                <button id="images" type="button" class="btn btn-block btn-primary" data-container="body" data-toggle="popover"
                        data-placement="bottom">
                    图库
                </button>
            </div>
            <div class="col-xs-12">
                {{ writeArticleForm.body(class="form-control", rows="30", placeholder="仅支持Markdown语法")}}
            </div>
            <div class="col-xs-12 col-sm-6">
                <div class="input-group">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-book"></i></span>
                    {{ writeArticleForm.category(class="form-control", placeholder="文章类表")}}
                </div>
            </div>
            <div class="col-xs-12 col-sm-6">
                <div class="input-group">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-tags"></i></span>
                    {{ writeArticleForm.tags(class="form-control", placeholder="文章标签，用逗号分隔")}}
                </div>
            </div>
            <div class="col-xs-12">
                <div class="pull-right">
                    <input class="btn btn-default" type="reset" value="重 置">
                    {{ writeArticleForm.submit(class="btn btn-primary")}}
                </div>
            </div>
        </form>
        <div class="modal fade" id="myFolder" tabindex="-1" role="dialog" aria-labelledby="myFolderLabel">
            <div class="modal-dialog modal-sm" role="document">
                <form method="post" role="form" enctype="multipart/form-data" action="">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="form-group">
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="glyphicon glyphicon-folder-open"></i> </span>
                                    <input type="text" class="form-control" placeholder="新建文件夹">
                                </div>
                            </div>
                            <div class="text-right">
                                <button type="submit" class="btn btn-xs btn-primary">确定</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div id="popover-content" class="hide">
    <div class="col-xs-12">
        <div class="pull-right">
            <a type="button" title="返回" class="btn btn-xs"><i class="glyphicon glyphicon-chevron-left"></i> </a>
            <label class="btn btn-xs" title="上传图片">
                <i class="glyphicon glyphicon-cloud-upload"></i>  <input type="file" style="display: none;">
            </label>
            <a type="button" title="新建文件夹" class="btn btn-xs" data-toggle="modal" data-target="#myFolder"><i class="glyphicon glyphicon-plus"></i> </a>
        </div>
        <span id="current_path">{{ directory.current_path }}</span>
    </div>
    <div id="finders">

    </div>
</div>
{% endblock %}
{% block js %}
{{ super() }}
<script>
    $(document).ready(function () {
        $('#images').popover({
            html: true,
            content: function () {
                var content = $('#popover-content');
                var finders = $('#finders');
                var current_path = $('#current_path');
                $.ajax({
                    url: "{{ url_for('admin.finder', path='basedir') }}",
                    dataType: "json",
                    async: false,
                    success: function(data){
                        current_path.text(data.current_path);
                        var htmlText = '';
                        $.each(data.directory, function(i, n){
                            if (n["type"] === 'folder'){
                                htmlText += '<div class="col-xs-6 col-sm-4">'+
                                '<a data-id="' + n["name"] + '" href="/admin/finder/'+ n["name"] + '" >' +
                                '<img class="picture" src="/admin/images/folder.jpg" alt="' + n["name"] + '">' +
                                '</a>' +
                                '<p class="small">' + n["name"] + '</p>' +
                                '</div>'
                                var folder = $('#a[data-id =' + n["name"] + ']');
                            }
                            else {
                                htmlText += '<div class="col-xs-6 col-sm-4">'+
                                '<img class="picture" src="/admin/pictures/' + n["name"] + '" alt="' + n["name"] + '">' +
                                '<p class="small">' + n["name"] + '</p>' +
                                '</div>'
                            }
                        });
                        finders.html('');
                        finders.append(htmlText);
                    }
                });
                //console.log(htmlText);
                return content.html();
            }
        });
    })
</script>
{% endblock %}

